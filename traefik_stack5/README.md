## Introduction

This docker stack will run many services (Traefik, Socat, Portainer, Nginx, Caddy, Whoami) in one simple copy-paste command. Please also refer the the [README](https://github.com/pascalandy/docker-stack-this/blob/master/README.md) at the root of this repo.


## Start here
1. Go to http://labs.play-with-docker.com/ 
2. Create *one instance*. Wait for the node to provision
3. Copy-paste:

#### STABLE setup (recommanded)

```
# --- Setup the stack ---
ENV_STABLE_BRANCH="master"
ENV_MONOREPO="traefik_stack5"

# --- Setup the stack ---
source <(curl -s https://raw.githubusercontent.com/pascalandy/docker-stack-this/master/play-with-docker-setup.sh) && \
sleep 2 && \
git checkout "$ENV_STABLE_BRANCH" && \
cd "$ENV_MONOREPO" && \
./runup.sh;
```

#### EDGE setup (not recommanded)

```
# --- Setup the stack ---
ENV_EDGE_BRANCH="1.53"
ENV_MONOREPO="traefik_stack5"

# --- Setup the stack ---
source <(curl -s https://raw.githubusercontent.com/pascalandy/docker-stack-this/master/play-with-docker-setup.sh) && \
sleep 2 && \
git checkout "$ENV_EDGE_BRANCH" && \
cd "$ENV_MONOREPO" && \
./runup.sh;
```

The script `runup.sh` will do the hard and deplo the stacks for us. Once deployed, you will see: 


#### See your stacks

```
$ docker stack ls

NAME                SERVICES
toolmonitor         1
toolproxy           2
toolweb             3
```


#### See your services

```
$ docker service ls

ID                  NAME                    MODE                REPLICAS            IMAGE                        PORTS
q1oombe6uumc        toolmonitor_portainer   replicated          1/1                 portainer/portainer:1.15.5
8k1ev71vqmdn        toolproxy_socat         replicated          1/1                 devmtl/socatproxy:1.0B
uvcjqggv66pe        toolproxy_traefik       replicated          1/1                 traefik:1.5.0-rc2-alpine     *:80->80/tcp,*:8080->8080/tcp
mgpw3g2301mg        toolweb_home            replicated          2/2                 abiosoft/caddy:0.10.10
tim2vt8w9jzj        toolweb_who1            replicated          2/2                 nginx:1.13.7-alpine
y1r259m435y5        toolweb_who2            replicated          2/2                 emilevauge/whoami:latest
```

## Confirm that your services (containers) are running
1. When you see that all services are deployed, click on `80` to see the static landing page.
2. From the same URL generated by play-with-docker, in the address bar of your browser, add `/who1/` or `/who2/` or `/portainer/` to access other services.


#### Example
```
http://pwd10-0-7-3-80.host1.labs.play-with-docker.com/
http://pwd10-0-7-3-80.host1.labs.play-with-docker.com/who1/
http://pwd10-0-7-3-80.host1.labs.play-with-docker.com/who2/
http://pwd10-0-7-3-80.host1.labs.play-with-docker.com/portainer/
```

The container for the first URL is actually named `home`.


#### Web apps details:
- **/** = [caddy](https://hub.docker.com/r/abiosoft/caddy/)
- **/who1/** = [nginx](https://hub.docker.com/_/nginx/)
- **/who2/** = [whoami](https://hub.docker.com/r/emilevauge/whoami/)
- **/portainer/** = [portainer](https://hub.docker.com/r/portainer/portainer/)

Portainer requires a slash `/` at the end of the path. There is something to tweak with Traefik Labels in order for it to accept the proxy the request without the slash `/` at the end.

#### Anything special about this mono repo?

- This stack does not use ACME (https://). ACME is a pain while developping â€¦ reaching limits, etc.
- If you donâ€™t want to use socat, checkout the monorepo `traefik-manager-noacme`


## Screenshots

![docker-stack-this-stack5_11](https://user-images.githubusercontent.com/6694151/34073735-76c60ae2-e26e-11e7-85a1-755a7177b3f2.jpg)
![docker-stack-this-stack5_12](https://user-images.githubusercontent.com/6694151/34073736-76d461c8-e26e-11e7-9aea-c8dbc049a383.jpg)
![docker-stack-this-stack5_13](https://user-images.githubusercontent.com/6694151/34073737-76e1d998-e26e-11e7-8b7c-c619e91adadd.jpg)
![docker-stack-this-stack5_14](https://user-images.githubusercontent.com/6694151/34073738-76f163ae-e26e-11e7-86d7-27ea62ae3284.jpg)
![docker-stack-this-stack5_15](https://user-images.githubusercontent.com/6694151/34073739-77006d4a-e26e-11e7-8f2e-cbd4268ea403.jpg)
![docker-stack-this-stack5_16](https://user-images.githubusercontent.com/6694151/49540846-158f4700-f89f-11e8-8e14-ceca2ff2b910.jpg)

![docker-stack-this-stack5_17](https://user-images.githubusercontent.com/6694151/49540848-1922ce00-f89f-11e8-9fdc-b6fce70825c8.jpg)


## All commands
In the active path, just execute those bash-scripts:

- `./runup.sh`
- `./rundown.sh`
- `./runctop.sh`

**Bonus!** `./runctop.sh` is not a stack but a simple docker run to see the memory consumed by each containers.


## What is Traefik?
[Traefik](https://docs.traefik.io/configuration/backends/docker/) is a powerful layer 7 reverse proxy. Once running, the proxy will give you access to many web apps. I think this is a solid use cases to understand how this reverse-proxy works.


#### Traefik version 
In `toolproxy.yml` look for something like `traefik:1.7.4`.

In some mono-repo I **my own traefik image**. Feel free to use the official images. It will not break anything.


## Backlog
Here is whatâ€™s missing to make this stack perfect?
 
- Secure traefik dashboard
- Use SSL endpoints (ACME)
- Fix the need to use a trailing slash `/` at the end of Portainer service


## Contributing

Thanks to the power of communities, this is where `1 + 1 = 3`.

1. Fork it
2. Create your feature branch: `git checkout -b my-new-feature`
3. Commit your changes: `git commit -am 'Add some feature'`
4. Push to the branch: `git push origin my-new-feature`
5. Submit a pull request


## License & Sources

- View the **GNU** license information at https://github.com/pascalandy/GNU-GENERAL-PUBLIC-LICENSE
- This Git repo is available at https://github.com/pascalandy/docker-stack-this


## Author

In the world of OSS (open source software) most people refer themselves as maintainers. The thing isâ€¦ I hate this expression. It feels heavy and not fun. I much prefer author.


#### Hosting

Looking to **kick-start your website** (static page + a CMS) ? Take a look at [play-with-ghost](http://play-with-ghost.com/) (another project I shared). It allows you to see and edit websites made with **Ghost**. In short, you can try Ghost on the spot without having to sign up! Just use the dummy email & password provided.

#### Iâ€™m looking for help

If you have solid skills ðŸ¤“ with Docker Swarm, Linux bash and the gang and youâ€™re looking to help a startup to launch a solid project, I would love to get to know you. Buzz me ðŸ‘‹ on Twitter [@askpascalandy](https://twitter.com/askpascalandy). You can see the things that are done and the things we have to do [here](http://firepress.org/blog/technical-challenges-we-are-facing-now/).

Iâ€™m looking for bright and caring people to join this [journey](http://firepress.org/blog/tag/from-the-heart/) with me.

```
 ____                     _      _              _
|  _ \ __ _ ___  ___ __ _| |    / \   _ __   __| |_   _
| |_) / _` / __|/ __/ _` | |   / _ \ | '_ \ / _` | | | |
|  __/ (_| \__ \ (_| (_| | |  / ___ \| | | | (_| | |_| |
|_|   \__,_|___/\___\__,_|_| /_/   \_\_| |_|\__,_|\__, |
                                                  |___/
```

Shared by [Pascal Andy](https://pascalandy.com/blog/now/). Find me on [Twitter](https://twitter.com/askpascalandy).